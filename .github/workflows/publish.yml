on: [push]

jobs:
  publish:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      deployments: write
    name: Publish to Cloudflare Pages
    steps:
      - name: Checkout
        uses: actions/checkout@v3
  
      - uses: actions/cache@v2
              with:
                path: ~/.npm
                key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
                restore-keys: |
                  ${{ runner.os }}-node-
            - uses: actions/setup-node@v2
              with:
                node-version: "16.16.0"
            - run: npm i -g npm@8.13.2
            - name: Install dependencies
              run: npm ci
            - name: Health check
              run: npm run health-check
            - name: Build
        run: npm run build
      # Run a build step here if your project requires

      - name: Publish to Cloudflare Pages
        uses: cloudflare/pages-action@1
        with:
          apiToken: cdtsnPxe4r8JNM1_e2d59oYoCkKPrDGL6FWpufQX
          accountId: d5e572ca2ba04352a0f46d3be80fd12f
          projectName: DEPLOYMENT_ANALYSIS-2
          directory: build
          gitHubToken: ${{ secrets.GITHUB_TOKEN }}